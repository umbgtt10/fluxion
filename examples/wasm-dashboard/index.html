<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fluxion WASM Dashboard - Reactive Operators Demo</title>
    <link data-trunk rel="css" href="www/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üåä Fluxion WASM Dashboard</h1>
            <p class="subtitle">Real-time demonstration of reactive stream operators</p>
        </header>

        <main>
            <!-- Control Panel -->
            <section class="control-panel">
                <h2>Controls</h2>
                <div class="button-group">
                    <button id="startBtn" class="btn btn-primary">‚ñ∂Ô∏è Start</button>
                    <button id="stopBtn" class="btn btn-danger" disabled>‚èπÔ∏è Stop</button>
                    <button id="closeBtn" class="btn btn-secondary">‚ùå Close</button>
                </div>
            </section>

            <!-- Sensor Windows (Top Section - 3 windows) -->
            <section class="sensor-section">
                <h2>üì° Raw Sensor Streams</h2>
                <div class="sensor-grid">
                    <div class="window-card sensor">
                        <h3>Sensor 1</h3>
                        <p class="window-desc">Values: 1-9 | Frequency: 1-5 Hz</p>
                        <div id="sensor1Window" class="data-window">
                            <div class="waiting">Waiting for data...</div>
                        </div>
                    </div>
                    <div class="window-card sensor">
                        <h3>Sensor 2</h3>
                        <p class="window-desc">Values: 10-90 | Frequency: 1-5 Hz</p>
                        <div id="sensor2Window" class="data-window">
                            <div class="waiting">Waiting for data...</div>
                        </div>
                    </div>
                    <div class="window-card sensor">
                        <h3>Sensor 3</h3>
                        <p class="window-desc">Values: 100-900 | Frequency: 1-5 Hz</p>
                        <div id="sensor3Window" class="data-window">
                            <div class="waiting">Waiting for data...</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Combined Stream Window (Middle Section - 1 window) -->
            <section class="combined-section">
                <h2>üîó Combined Stream</h2>
                <div class="window-card combined">
                    <h3>CombineLatest -> Sum -> Filter</h3>
                    <p class="window-desc">Sum of all sensors. Then filter numbers not divisible by 3.</p>
                    <div id="combinedWindow" class="data-window large">
                        <div class="waiting">Waiting for data...</div>
                    </div>
                </div>
            </section>

            <!-- Processed Streams (Bottom Section - 6 windows) -->
            <section class="processed-section">
                <h2>‚öôÔ∏è Processed Streams</h2>
                <div class="processed-grid">
                    <div class="window-card processed">
                        <h3>Debounced</h3>
                        <p class="window-desc">Only emits after 700ms of inactivity</p>
                        <div id="debounceWindow" class="data-window">
                            <div class="waiting">Waiting for data...</div>
                        </div>
                    </div>
                    <div class="window-card processed">
                        <h3>Delayed</h3>
                        <p class="window-desc">Delays all values by 1 second</p>
                        <div id="delayWindow" class="data-window">
                            <div class="waiting">Waiting for data...</div>
                        </div>
                    </div>
                    <div class="window-card processed">
                        <h3>Throttled</h3>
                        <p class="window-desc">Max one emission per 800ms</p>
                        <div id="throttleWindow" class="data-window">
                            <div class="waiting">Waiting for data...</div>
                        </div>
                    </div>
                    <div class="window-card processed">
                        <h3>Sampled</h3>
                        <p class="window-desc">Samples latest value every 1 second</p>
                        <div id="sampleWindow" class="data-window">
                            <div class="waiting">Waiting for data...</div>
                        </div>
                    </div>
                    <div class="window-card processed">
                        <h3>Timeout</h3>
                        <p class="window-desc">Errors if no emission within 2 seconds</p>
                        <div id="timeoutWindow" class="data-window">
                            <div class="waiting">Waiting for data...</div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <p>Built with ü¶Ä Rust + WASM | Powered by Fluxion Reactive Streams</p>
            <p>Author: Umberto Gotti</p>
            <p>Email: umberto.gotti@umbertogotti.dev</p>
        </footer>
    </div>

    <script type="module">
        // Wait for WASM to load, then start dashboard
        window.addEventListener('TrunkApplicationStarted', async () => {
            console.log('WASM loaded, starting dashboard...');
            await window.wasmBindings.start_dashboard();
        });
    </script>
</body>
</html>
